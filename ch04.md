# H.264 是什么

## 4.1 引言

本章从多个角度介绍 H.264。首先，我们要解决一个问题---什么是H.264？从不同的角度看，H.264 可能意味着不同的事情。它是工业标准，定义了压缩视频数据的格式，提供了一套工具，用各种方式压缩和传输视觉信息。这是一些列视频压缩标准化方法发展的一个阶段。我们看一下 H264 编码器和解码器中执行的基本操作。我们更深入地了解 H.264，检查 H.264 标准中包含了什么，主要的工具和组件集，呈现了 H.264 压缩的概要语法和格式，更详细地查看通过典型 H.264 编解码的数据流。最后，我们讨论一些实际问题---H.264在工作中有多出色，H.264在真实应用程序中使用的。

## 4.2 H.264 是什么

H.264/AVC 是一种视频编码的工业标准，它也是编码视频的流行格式，是一套视频压缩工具，也是不断发展的数字视频通信领域的舞台。本节介绍 H.264/AVC 的一些“视图”。

### 4.2.1 视频压缩格式

H.264 是一种用于视频压缩的方法和格式，是将数字视频转换为存储或传输时占用较少容量的格式的过程。视频压缩或视频编码是数字电视、DVD视频、移动电视、视频会议和互联网视频流等应用的关键技术。标准化的视频压缩使得来自不同制造商的产品(如编码器、解码器和存储介质)能够相互操作。编码器将视频转换为压缩格式，解码器将压缩视频转换为未压缩格式。

在诸如远程监控这种典型的 H.264 应用中，使用 H.264 对来自摄像头的视频进行编码或传输，以产生 H.264 比特流。它通过网络发送到解码端，解码器重建原视频，如图 1.1 所示。图 1.1 显示了源视频(未压缩的视频材料)是如何由编码器编码并存储在服务器上的。压缩视频，一个比特序列，被传输到一个或多个客户端。在双向对话视频应用中，如视频会议,Skype 视频等，系统的两端需要一个编码器来压缩来自本地摄像头的视频，需要一个解码器来解压来自远程摄像机的视频，如图 1.2 所示。

### 4.2.2 一个工业标准

H.264：高级视频编码是由国际电联(国际电信联盟)和ISO/IEC(国际标准化组织/国际电工委员会)两个国际标准机构共同出版的文件。它定义了压缩视频的格式和语法，以及解码该语法以产生可显示视频序列的方法。标准文档并没有指定如何对数字视频进行编码--这由视频编码器的制造商负责--但实际上编码器是解码过程的镜像。图 4.1 给出了编码和解码过程，并突出显示了 H.264 标准所涵盖的部分。

H.264/AVC 标准于 2003 年首次发布，此后出版了几次修订和更新。它建立在早期标准(如 MPEG-2和 MPEG-4)的概念之上，具有更好的压缩效率，即更好的压缩视频质量，以及在压缩、传输和存储视频方面的更大灵活性。

### 4.2.3 视频压缩的工具集

H.264/AVC 描述了一组用于视频压缩的工具和方法。该标准规定了用这些工具编码的视频如何表示和解码。视频编码器可以选择使用哪些工具以及如何将他们应用于当前视频序列，但有一些限制。兼容 H.264 的解码器必须能够使用定义的工具子集，称为配置文件。

### 4.2.4 更好的视频压缩

H.264标准之所以得到如此广泛的应用，是因为与早期标准相比，它的性能得到了提高。大众市场应用(如数字电视和 DVD 视频上的消费视频存储)的基准是早期的 MPEG-2 标准。H.24 提供了比  MPEG-2 更好的压缩性能。在相同的视频分辨率和图像质量下，使用 H.264 可以将视频压缩成比使用 MPEG-2 少很多的比特数。这意味着，通过使用 H.264 格式，可以将更多的视频存储在磁盘上或通过广播信道传输。

## 4.3 H.264 codec 如何工作的

H.264 视频编码器执行预测、转换和编码处理(如图 4.1),以生成压缩的 H.264 比特流。H.264 视频解码器执行解码、逆变换和重构的处理以产生解码的视频序列。如图 4.2 所示，原始视频帧或场的序列被编码成 H.264 格式，一系列的比特流代表压缩的视频数据。该压缩比特流被存储或传输，并且可以被解码以重构视频序列。通常，解码版本与原始序列不相同，因为 H.264 是有损压缩格式，即在压缩期间丢失一些图片质量。

被编码的帧或场(如图 4.3 中的 Frame A)，由与 H.264 兼容的视频编码器处理。除了将帧作为编码比特流或编码文件的一部分进行编码和发送外，编码器也会重构帧，即创建最终由解码器产生的解码帧 A 的副本。该重建副本可以存储在编码图片缓冲器 CPB 中，并且在未来帧的编码期间使用。解码器接受编码比特流并解码帧用于显示或后处理。同时，解码器可能存在解码帧的副本在解码图片缓冲区 DPB 中，以在未来帧的解码时使用。

图4.4（编码器）和图4.5（解码器）更详细地显示了典型 H.264 编解码器的结构。数据的处理是以宏块为单位进行的，对应的显示像素是 16x16。在编码器中，生成预测宏块，并从当前宏块中减去预测宏块以形成残差宏块，它会被变换、量化和编码。同时，量化数据被反量化和逆变换，并被添加到预测宏块中以重构帧的编码版本，该编码版本被存储以供以后的预测。在解码端宏块被解码、反量化、逆变换形成解码后的残差宏块。解码器生成在编码端创建的相同预测，并将其添加残差中以产生解码宏块。

### 4.3.1 编码器处理

